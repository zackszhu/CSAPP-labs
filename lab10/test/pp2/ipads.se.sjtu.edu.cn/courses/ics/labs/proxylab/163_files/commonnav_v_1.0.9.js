(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m=[].slice,n=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},o={}.hasOwnProperty,p=function(a,b){function c(){this.constructor=a}for(var d in b)o.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},q=function(a,b){return function(){return a.apply(b,arguments)}};c={bind:function(a,b){var c,d,e,f,g;for(d=a.split(" "),c=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={}),f=0,g=d.length;g>f;f++)e=d[f],c[e]||(c[e]=[]),c[e].push(b);return this},one:function(a,b){return this.bind(a,function(){return this.unbind(a,arguments.callee),b.apply(this,arguments)})},trigger:function(){var a,b,c,d,e,f,g;if(a=1<=arguments.length?m.call(arguments,0):[],c=a.shift(),d=this.hasOwnProperty("_callbacks")&&(null!=(g=this._callbacks)?g[c]:void 0)){for(e=0,f=d.length;f>e&&(b=d[e],b.apply(this,a)!==!1);e++);return!0}},unbind:function(a,b){var c,d,e,f,g,h;if(!a)return this._callbacks={},this;if(e=null!=(h=this._callbacks)?h[a]:void 0,!e)return this;if(!b)return delete this._callbacks[a],this;for(d=f=0,g=e.length;g>f;d=++f)if(c=e[d],c===b){e=e.slice(),e.splice(d,1),this._callbacks[a]=e;break}return this}},d={trace:!0,logPrefix:"(App)",log:function(){var a;return a=1<=arguments.length?m.call(arguments,0):[],this.trace?(this.logPrefix&&a.unshift(this.logPrefix),"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,a),this):void 0}},l=["included","extended"],f=function(){function a(){"function"==typeof this.init&&this.init.apply(this,arguments)}return a.include=function(a){var b,c,d;if(!a)throw new Error("include(obj) requires obj");for(b in a)c=a[b],n.call(l,b)<0&&(this.prototype[b]=c);return null!=(d=a.included)&&d.apply(this),this},a.extend=function(a){var b,c,d;if(!a)throw new Error("extend(obj) requires obj");for(b in a)c=a[b],n.call(l,b)<0&&(this[b]=c);return null!=(d=a.extended)&&d.apply(this),this},a.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a.prototype.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a}(),e=function(b){function d(a){d.__super__.constructor.apply(this,arguments),a&&this.load(a),this.cid=this.constructor.uid("c-")}return p(d,b),d.extend(c),d.records={},d.crecords={},d.attributes=[],d.configure=function(){var a,b;return b=arguments[0],a=2<=arguments.length?m.call(arguments,1):[],this.className=b,this.records={},this.crecords={},a.length&&(this.attributes=a),this.attributes&&(this.attributes=k(this.attributes)),this.attributes||(this.attributes=[]),this.unbind(),this},d.toString=function(){return""+this.className+"("+this.attributes.join(", ")+")"},d.find=function(a){var b;if(b=this.records[a],!b&&(""+a).match(/c-\d+/))return this.findCID(a);if(!b)throw new Error("Unknown record");return b.clone()},d.findCID=function(a){var b;if(b=this.crecords[a],!b)throw new Error("Unknown record");return b.clone()},d.exists=function(a){try{return this.find(a)}catch(b){return!1}},d.refresh=function(a,b){var c,d,e,f;for(null==b&&(b={}),b.clear&&(this.records={},this.crecords={}),d=this.fromJSON(a),i(d)||(d=[d]),e=0,f=d.length;f>e;e++)c=d[e],c.id||(c.id=c.cid),this.records[c.id]=c,this.crecords[c.cid]=c;return this.trigger("refresh",this.cloneArray(d)),this},d.select=function(a){var b,c,d;return d=function(){var d,e;d=this.records,e=[];for(b in d)c=d[b],a(c)&&e.push(c);return e}.call(this),this.cloneArray(d)},d.findByAttribute=function(a,b){var c,d,e;e=this.records;for(c in e)if(d=e[c],d[a]===b)return d.clone();return null},d.findAllByAttribute=function(a,b){return this.select(function(c){return c[a]===b})},d.each=function(a){var b,c,d,e;d=this.records,e=[];for(b in d)c=d[b],e.push(a(c.clone()));return e},d.all=function(){return this.cloneArray(this.recordsValues())},d.first=function(){var a;return a=this.recordsValues()[0],null!=a?a.clone():void 0},d.last=function(){var a,b;return b=this.recordsValues(),a=b[b.length-1],null!=a?a.clone():void 0},d.count=function(){return this.recordsValues().length},d.deleteAll=function(){var a,b,c,d;c=this.records,d=[];for(a in c)b=c[a],d.push(delete this.records[a]);return d},d.destroyAll=function(){var a,b,c,d;c=this.records,d=[];for(a in c)b=c[a],d.push(this.records[a].destroy());return d},d.update=function(a,b,c){return this.find(a).updateAttributes(b,c)},d.create=function(a,b){var c;return c=new this(a),c.save(b)},d.destroy=function(a,b){return this.find(a).destroy(b)},d.change=function(a){return"function"==typeof a?this.bind("change",a):this.trigger("change",a)},d.fetch=function(a){return"function"==typeof a?this.bind("fetch",a):this.trigger("fetch",a)},d.toJSON=function(){return this.recordsValues()},d.fromJSON=function(a){var b,c,d,e;if(a){if("string"==typeof a&&(a=JSON.parse(a)),i(a)){for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(new this(b));return e}return new this(a)}},d.fromForm=function(){var a;return(a=new this).fromForm.apply(a,arguments)},d.recordsValues=function(){var a,b,c,d;b=[],d=this.records;for(a in d)c=d[a],b.push(c);return b},d.cloneArray=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(b.clone());return e},d.idCounter=0,d.uid=function(a){var b;return null==a&&(a=""),b=a+this.idCounter++,this.exists(b)&&(b=this.uid(a)),b},d.prototype.isNew=function(){return!this.exists()},d.prototype.isValid=function(){return!this.validate()},d.prototype.validate=function(){},d.prototype.load=function(a){var b,c;for(b in a)c=a[b],"function"==typeof this[b]?this[b](c):this[b]=c;return this},d.prototype.attributes=function(){var a,b,c,d,e;for(b={},e=this.constructor.attributes,c=0,d=e.length;d>c;c++)a=e[c],a in this&&(b[a]="function"==typeof this[a]?this[a]():this[a]);return this.id&&(b.id=this.id),b},d.prototype.eql=function(a){return!!(a&&a.constructor===this.constructor&&a.cid===this.cid||a.id&&a.id===this.id)},d.prototype.save=function(a){var b,c;return null==a&&(a={}),a.validate!==!1&&(b=this.validate())?(this.trigger("error",b),!1):(this.trigger("beforeSave",a),c=this.isNew()?this.create(a):this.update(a),this.trigger("save",a),c)},d.prototype.updateAttribute=function(a,b,c){return this[a]=b,this.save(c)},d.prototype.updateAttributes=function(a,b){return this.load(a),this.save(b)},d.prototype.changeID=function(a){var b;return b=this.constructor.records,b[a]=b[this.id],delete b[this.id],this.id=a,this.save()},d.prototype.destroy=function(a){return null==a&&(a={}),this.trigger("beforeDestroy",a),delete this.constructor.records[this.id],delete this.constructor.crecords[this.cid],this.destroyed=!0,this.trigger("destroy",a),this.trigger("change","destroy",a),this.unbind(),this},d.prototype.dup=function(a){var b;return b=new this.constructor(this.attributes()),a===!1?b.cid=this.cid:delete b.id,b},d.prototype.clone=function(){return h(this)},d.prototype.reload=function(){var a;return this.isNew()?this:(a=this.constructor.find(this.id),this.load(a.attributes()),a)},d.prototype.toJSON=function(){return this.attributes()},d.prototype.toString=function(){return"<"+this.constructor.className+" ("+JSON.stringify(this)+")>"},d.prototype.fromForm=function(b){var c,d,e,f,g;for(d={},g=a(b).serializeArray(),e=0,f=g.length;f>e;e++)c=g[e],d[c.name]=c.value;return this.load(d)},d.prototype.exists=function(){return this.id&&this.id in this.constructor.records},d.prototype.update=function(a){var b,c;return this.trigger("beforeUpdate",a),c=this.constructor.records,c[this.id].load(this.attributes()),b=c[this.id].clone(),b.trigger("update",a),b.trigger("change","update",a),b},d.prototype.create=function(a){var b,c;return this.trigger("beforeCreate",a),this.id||(this.id=this.cid),c=this.dup(!1),this.constructor.records[this.id]=c,this.constructor.crecords[this.cid]=c,b=c.clone(),b.trigger("create",a),b.trigger("change","create",a),b},d.prototype.bind=function(a,b){var c,d,e=this;return this.constructor.bind(a,c=function(a){return a&&e.eql(a)?b.apply(e,arguments):void 0}),this.constructor.bind("unbind",d=function(b){return b&&e.eql(b)?(e.constructor.unbind(a,c),e.constructor.unbind("unbind",d)):void 0}),c},d.prototype.one=function(a,b){var c,d=this;return c=this.bind(a,function(){return d.constructor.unbind(a,c),b.apply(d,arguments)})},d.prototype.trigger=function(){var a,b;return a=1<=arguments.length?m.call(arguments,0):[],a.splice(1,0,this),(b=this.constructor).trigger.apply(b,a)},d.prototype.unbind=function(){return this.trigger("unbind")},d}(f),b=function(b){function e(b){this.release=q(this.release,this);var c,d,f;this.options=b,f=this.options;for(c in f)d=f[c],this[c]=d;this.el||(this.el=document.createElement(this.tag)),this.el=a(this.el),this.$el=this.el,this.className&&this.el.addClass(this.className),this.attributes&&this.el.attr(this.attributes),this.events||(this.events=this.constructor.events),this.elements||(this.elements=this.constructor.elements),this.events&&this.delegateEvents(this.events),this.elements&&this.refreshElements(),e.__super__.constructor.apply(this,arguments)}return p(e,b),e.include(c),e.include(d),e.prototype.eventSplitter=/^(\S+)\s*(.*)$/,e.prototype.tag="div",e.prototype.release=function(){return this.trigger("release"),this.el.remove(),this.unbind()},e.prototype.$=function(b){return a(b,this.el)},e.prototype.delegateEvents=function(a){var b,c,d,e,f,g,h=this;g=[];for(c in a){if(e=a[c],"function"==typeof e)e=function(a){return function(){return a.apply(h,arguments),!0}}(e);else{if(!this[e])throw new Error(""+e+" doesn't exist");e=function(a){return function(){return h[a].apply(h,arguments),!0}}(e)}d=c.match(this.eventSplitter),b=d[1],f=d[2],g.push(""===f?this.el.bind(b,e):this.el.delegate(f,b,e))}return g},e.prototype.refreshElements=function(){var a,b,c,d;c=this.elements,d=[];for(a in c)b=c[a],d.push(this[b]=this.$(a));return d},e.prototype.delay=function(a,b){return setTimeout(this.proxy(a),b||0)},e.prototype.html=function(a){return this.el.html(a.el||a),this.refreshElements(),this.el},e.prototype.append=function(){var a,b,c;return b=1<=arguments.length?m.call(arguments,0):[],b=function(){var c,d,e;for(e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(a.el||a);return e}(),(c=this.el).append.apply(c,b),this.refreshElements(),this.el},e.prototype.appendTo=function(a){return this.el.appendTo(a.el||a),this.refreshElements(),this.el},e.prototype.prepend=function(){var a,b,c;return b=1<=arguments.length?m.call(arguments,0):[],b=function(){var c,d,e;for(e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(a.el||a);return e}(),(c=this.el).prepend.apply(c,b),this.refreshElements(),this.el},e.prototype.replace=function(b){var c,d;return d=[this.el,a(b.el||b)],c=d[0],this.el=d[1],c.replaceWith(this.el),this.delegateEvents(this.events),this.refreshElements(),this.el},e}(f),a=("undefined"!=typeof window&&null!==window?window.jQuery:void 0)||("undefined"!=typeof window&&null!==window?window.Zepto:void 0)||function(a){return a},h=Object.create||function(a){var b;return b=function(){},b.prototype=a,new b},i=function(a){return"[object Array]"===Object.prototype.toString.call(a)},j=function(a){var b;if(!a)return!0;for(b in a)return!1;return!0},k=function(a){return Array.prototype.slice.call(a,0)},g=this.Spine={},"undefined"!=typeof module&&null!==module&&(module.exports=g),g.version="1.0.8",g.isArray=i,g.isBlank=j,g.$=a,g.Events=c,g.Log=d,g.Module=f,g.Controller=b,g.Model=e,f.extend.call(g,c),f.create=f.sub=b.create=b.sub=e.sub=function(a,b){var c;return c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return p(b,a),b}(this),a&&c.include(a),b&&c.extend(b),"function"==typeof c.unbind&&c.unbind(),c},e.setup=function(a,b){var c;return null==b&&(b=[]),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return p(b,a),b}(this),c.configure.apply(c,[a].concat(m.call(b))),c},g.Class=f}).call(this),function(){var a=window.NTES||{};a.event||(a.event={}),a.plugin=a.plugin||{},a.event.Mouseenter=function(a,b,c){var d,e=document.createElement("div"),f="onmouseenter"in e,g=a,h="",i=c;switch(g){case"mouseenter":h="mouseover";break;case"mouseleave":h="mouseout";break;default:return null}return g=f?g:h,d=f?b:function(a){var c=a.relatedTarget;for(!a.relatedTarget&&a.fromElement&&(a.relatedTarget=a.fromElement==a.target?a.toElement:a.fromElement);c&&c!=this;)try{c=c.parentNode}catch(d){c=this}c!=this&&b.call(this,a)},i.addEvent(g,d),{eventName:g,eventHandler:d}}}(),function(a){var b=function(){var b=this;b.selector=".js_N_navSelect",b.unfoldClassName="ntes-nav-select-unfold",b.menus=a(b.selector),b.eventsCache=[],b.init(),b.prevIndex=0};b.prototype={constructor:b,init:function(){var b=this;NTES.each(b.menus,function(c,d){var e=a(d),f={},g=NTES.event.Mouseenter("mouseenter",function(){a(this);b.timerList&&b.prevIndex===c?(clearTimeout(b.timerList),b.timerList=void 0):b.timerList=setTimeout(function(){b.unfoldMenu(c),b.timerList=void 0},100)},e),h=NTES.event.Mouseenter("mouseleave",function(){a(this);b.timerList&&b.prevIndex===c?(clearTimeout(b.timerList),b.timerList=void 0):b.timerList=setTimeout(function(){b.foldMenu(),b.timerList=void 0},100)},e),i=function(){var c=a(this);-1===c.className.indexOf(b.unfoldClassName)?c.addCss(b.unfoldClassName):c.removeCss(b.unfoldClassName)},j=function(d){a(this);switch(d.keyCode){case 39:b.unfoldMenu(c);break;case 40:b.unfoldMenu(c);break;case 37:b.foldMenu();break;case 38:b.foldMenu();break;case 27:b.foldMenu()}};e.addEvent("click",i).addEvent("keydown",j),f[g.eventName]=g.eventHandler,f[h.eventName]=h.eventHandler,f.click=i,f.keydown=j,b.eventsCache.push(f)})},unfoldMenu:function(b){var c=this;a(c.menus[c.prevIndex]).removeCss(c.unfoldClassName),a(c.menus[b]).addCss(c.unfoldClassName),c.prevIndex=b},foldMenu:function(){var b=this;a(b.menus[b.prevIndex]).removeCss(b.unfoldClassName)},destory:function(a,b){var c=this;if(!a)return void NTES.each(c.menus,function(a,b){var d=c.eventsCache[a];for(var e in d)b.removeEvent(e,d[e])});var d=c._getItem(a),e=d?c.eventsCache[d.index]:null;if(d){for(var f in e)d.item.removeEvent(f,e[f]);b&&b()}},_getItem:function(b){var c=this,d=c.menus,e=0,f=d.length,g=a(b);if(!g)return null;for(g=g.get(0);f>e;e++)if(d[e].get(0)==g)return{item:d[e],index:e};return null}},a.plugin=a.plugin||{},a.plugin.NTESSelectMenu=b}($),function(){var a=this,b=function(){};a.NTESCommonNavigator=a.NTESCommonNavigator||{},a.console=a.console||{log:b,error:b,trace:b,info:b},a.NTESCommonNavigator.namespace=function(){var b,c,d,e,f=arguments,g=null;for(b=0,e=f.length;e>b;b++)for(d=(""+f[b]).split("."),g=a.NTESCommonNavigator,c="NTESCommonNavigator"==d[0]?1:0;c<d.length;c+=1)g[d[c]]=g[d[c]]||{},g=g[d[c]];return g}}.call(this),NTESCommonNavigator.namespace("NTESCommonNavigator.core"),NTESCommonNavigator.core.Constant={Path:{WB_PATH:"http://t.163.com/service/newMessage/",DEFAULT_MAIL_PATH:"http://email.163.com#from=163nav_icon"},Domain:{DOMAIN:["126.com","yeah.net","163.com","188.com","vip.163.com","vip.126.com"],API:["mail.126.com","mail.yeah.net","mail.163.com","mail.188.com","vip.163.com","vip.126.com"]},PRODUCTS:{reg:{name:"\u901a\u884c\u8bc1",url:"http://reg.163.com/Main.jsp?username=pInfo"},"163.com":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://entry.mail.163.com/coremail/fcg/ntesdoor2?verifycookie=1&lightweight=1&df=163navi"},"126.com":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://entry.mail.126.com/cgi/ntesdoor?verifycookie=1&lightweight=1&style=-1&df=163navi"},"vip.126.com":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://reg.vip.126.com/enterMail.m"},"yeah.net":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://entry.yeah.net/cgi/ntesdoor?verifycookie=1&lightweight=1&style=-1&def=163navi"},"188.com":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://reg.mail.188.com/servlet/enter"},"vip.163.com":{name:"\u6211\u7684\u90ae\u7bb1",url:"http://reg.vip.163.com/enterMail.m?enterVip=true-----------"},lofter:{name:"\u6211\u7684\u004C\u004F\u0046\u0054\u0045\u0052",url:"http://www.lofter.com/?act=qb163rk_20141031_02"},photo:{name:"\u6211\u7684\u76f8\u518c",url:"http://photo.163.com/?username=pInfo"},yuehui:{name:"\u6211\u7684\u540c\u57ce\u7ea6\u4f1a",url:"http://yuehui.163.com/"},blog:{name:"\u6211\u7684\u535a\u5ba2",url:"http://blog.163.com/passportIn.do?entry=163"},ht:{name:"\u6211\u7684\u82b1\u7530",url:"http://love.163.com?keyfrom=163site.mynavi"},note:{name:"\u6211\u7684\u4e91\u7b14\u8bb0",url:"http://note.youdao.com/web?entry=163.com"},caipiaoyys:{name:"\u6211\u7684\u5f69\u7968",url:"http://caipiao.163.com/#from=www_top_entry"},cx:{name:"\u6211\u7684\u8f66\u9669",url:"http://baoxian.163.com/car/#from=www_top_entry"},baoxian:{name:"\u6211\u7684\u4fdd\u9669",url:"http://baoxian.163.com/#from=www_top_entry"},shop:{name:"\u7f51\u6613\u5546\u57ce",url:"http://mall.163.com/#from=www_top_entry"},easyread:{name:"\u7f51\u6613\u4e91\u9605\u8bfb",url:"http://yuedu.163.com/#f=topnav"}},DEFAULT_PRODUCTS:["lofter","photo","ht","yuehui","blog","note","caipiaoyys","cx","baoxian","shop","easyread"],LOG_IN_OUT_URL:"http://reg.163.com/Logout.jsp"},NTESCommonNavigator.namespace("NTESCommonNavigator.core"),NTESCommonNavigator.core.Event={Base:{DATA_LOADED:"event_core_data_loaded",DATA_FAILED:"event_core_data_failed",DATA_CHANGED:"event_core_data_changed",LOGIN_SUCCESS:"event_core_login_sucess",LOGIN_FAIL:"event_core_login_fail"},Model:{MAIL_INFO_LOADED:"event_model_mail_info_loaded",LOFTER_INFO_LOADED:"event_model_lofter_info_loaded"}},NTESCommonNavigator.namespace("NTESCommonNavigator.base"),NTESCommonNavigator.base.Class=function(){{var a=Spine.Class.create();Spine.Events}return a.include(Spine.Events),a.include({extend:a.extend}),new a},NTESCommonNavigator.namespace("NTESCommonNavigator.base"),NTESCommonNavigator.base.UI=function(){var a=NTESCommonNavigator.base.Class(),b=function(){};return b(),a.extend({}),a},function(){var a={"&":"&amp;","'":"&#39;",'"':"&quot;","<":"&lt;",">":"&gt;"};NTESCommonNavigator.namespace("NTESCommonNavigator.utils"),NTESCommonNavigator.utils.mix={encode:function(b){return b.replace(/[&"'<>]/g,function(b){return a[b]})}}}(),NTESCommonNavigator.namespace("NTESCommonNavigator.utils"),NTESCommonNavigator.utils.Suggestion=function(){function a(){var a=document.getElementById("js_passportUserNameList"),b=d.getXY(e.usernameInputElement).x,c=d.getXY(e.usernameInputElement).y;a.style.left=b+"px",a.style.top=c+e.usernameInputElement.offsetHeight+"px"}function b(a){var b=document.createElement("div");b.innerHTML=a,document.body.appendChild(b.firstChild),b=null}var c=NTESCommonNavigator.base.Class();String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"gm"),b)};var d={getXY:function(a){for(var b=0,c=0;a!=document.body&&null!=a;)c+=a.offsetLeft,b+=a.offsetTop,a=a.offsetParent;return{x:c,y:b}}},e={usernameInputElement:!1,usernameInputElementX:!1,usernameInputElementY:!1,usernameInputHeight:!1,usernameListElement:!1,currentSelectIndex:-1,hasShow:!1,domainSelectElmentString:'<div id = "js_passportUserNameList" class="ntes-domain-selector"  style="display: none;"><div class="ntes-domain-selector-main"><table width="100%" cellspacing="0" cellpadding="0"><tbody><tr><td class="ntes-domain-selector-title">\u8bf7\u9009\u62e9\u6216\u7ee7\u7eed\u8f93\u5165...</td></tr><tr><td><td /></tr></tbody></table></div><iframe src="javascript:\'\';"  style=" z-index:1008;width:100%;height:0px;display:block  " frameborder="0"></iframe></div><div style="display: none;"></div><div id="passport_111"></div>',domainSelectElement:!1,domainArray:["163.com","126.com","yeah.net","vip.163.com","vip.126.com","popo.163.com","188.com","vip.188.com","qq.com","yahoo.com","sina.com"],helpDivString:'<div style="width:100%;" id="passport_helper_div"></div>',resizeFunc:function(){var a=document.getElementById("js_passportUserNameList"),b=d.getXY(e.usernameInputElement).x,c=d.getXY(e.usernameInputElement).y;a.style.left=b+"px",a.style.top=c+e.usernameInputElement.offsetHeight+"px"},bind:function(a){this.usernameInputElement=a;var b=d.getXY(this.usernameInputElement);this.usernameInputElementX=b.x,this.usernameInputElementY=b.y,this.handle()},handle:function(){b(this.domainSelectElmentString),b(this.helpDivString),this.domainSelectElement=document.getElementById("js_passportUserNameList"),this.usernameListElement=this.domainSelectElement.firstChild.firstChild.rows[1].firstChild,this.currentSelectIndex=0,this.usernameInputElement.onblur=function(a){return e.preventEvent(a),setTimeout(function(){e.doSelect()},200),!1};try{this.usernameInputElement.addEventListener("keypress",this.keypressProc,!1),this.usernameInputElement.addEventListener("keyup",this.keyupProc,!1)}catch(c){try{this.usernameInputElement.attachEvent("onkeydown",this.checkKeyDown),this.usernameInputElement.attachEvent("onkeypress",this.keypressProc),this.usernameInputElement.attachEvent("onkeyup",this.keyupProc)}catch(c){}}a(),navigator.userAgent.indexOf("MSIE")>0?window.attachEvent("onresize",a):window.onresize=a},preventEvent:function(a){try{a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()}catch(a){}},checkKeyDown:function(a){this.currentSelectIndex=0;var b=a.keyCode;return 38==b||40==b?(e.preventEvent(a),e.clearFocus(),38==b?e.upSelectIndex():e.downSelectIndex(),e.setFocus(),!1):void 0},keyupProc:function(a){this.currentSelectIndex=0;var b=a.keyCode;e.changeUsernameSelect(),13==b&&e.doSelect();var c;return(c=navigator.userAgent.indexOf("Safari"))>0&&(38==b||40==b)&&(e.preventEvent(a),e.clearFocus(),38==b?e.upSelectIndex():e.downSelectIndex(),e.setFocus()),!1},keypressProc:function(a){this.currentSelectIndex=0;var b=a.keyCode;13==b?e.preventEvent(a):38==b||40==b?(e.preventEvent(a),e.clearFocus(),38==b?e.upSelectIndex():e.downSelectIndex(),e.setFocus()):(108==b||110==b||111==b||115==b)&&setTimeout(function(){e.changeUsernameSelect()},20)},clearFocus:function(a){var a=this.currentSelectIndex;try{var b=this.findTdElement(a);b.style.backgroundColor="white"}catch(c){}},findTdElement:function(a){try{for(var b=this.usernameListElement.firstChild.rows,c=0;c<b.length;++c)if(b[c].firstChild.idx==a)return b[c].firstChild}catch(d){}return!1},upSelectIndex:function(){var a=this.currentSelectIndex;if(null!=this.usernameListElement.firstChild){var b,c=this.usernameListElement.firstChild.rows;for(b=0;b<c.length&&c[b].firstChild.idx!=a;++b);this.currentSelectIndex=0==b?c.length-1:c[b-1].firstChild.idx}},downSelectIndex:function(){var a=this.currentSelectIndex;if(null!=this.usernameListElement.firstChild){for(var b=this.usernameListElement.firstChild.rows,c=0;c<b.length&&b[c].firstChild.idx!=a;++c);this.currentSelectIndex=c>=b.length-1?b[0].firstChild.idx:b[c+1].firstChild.idx}},setFocus:function(){var a=this.currentSelectIndex;try{var b=this.findTdElement(a);b.style.backgroundColor="#D5F1FF"}catch(c){}},changeUsernameSelect:function(){var b=this.usernameInputElement.value;if(b=b.replaceAll("<",""),""==b.trim())this.domainSelectElement.style.display="none",this.hasShow=!1;else{var c,d="",f="";(c=b.indexOf("@"))<0?(d=b,f=""):(d=b.substr(0,c),f=b.substr(c+1,b.length));var g=[];if(""==f)for(var h=0;h<this.domainArray.length;++h)g.push(d+"@"+this.domainArray[h]);else for(var h=0;h<this.domainArray.length;++h)0==this.domainArray[h].indexOf(f)&&g.push(d+"@"+this.domainArray[h]);if(g.length>0){a(),this.domainSelectElement.style.display="block",this.hasShow=!0;var i=document.createElement("TABLE");i.cellSpacing=0,i.cellPadding=3;var j=document.createElement("TBODY");i.appendChild(j);for(var h=0;h<g.length;++h){var k=document.createElement("TR"),l=document.createElement("TD");l.nowrap="true",l.align="left",l.innerHTML=g[h],l.idx=h,l.onmouseover=function(){e.clearFocus(),e.currentSelectIndex=this.idx,e.setFocus(),this.style.cursor="hand"},l.onmouseout=function(){},l.onclick=function(a){return e.doSelect(),e.preventEvent(a),!1},k.appendChild(l),j.appendChild(k)}this.usernameListElement.innerHTML="",this.usernameListElement.appendChild(i);for(var m=0,n=0;n<g.length;++n)g[n].length>m&&(m=g[n].length);m=10*m,185>m&&(m=185),i.style.width=m+"px",this.domainSelectElement.style.width=i.style.width,this.setFocus()}else this.domainSelectElement.style.display="none",this.hasShow=!1,this.currentSelectIndex=-1}},doSelect:function(){if(this.domainSelectElement.style.display="none",this.hasShow=!1,""!=this.usernameInputElement.value.trim()){var a=this.findTdElement(this.currentSelectIndex);a&&(this.usernameInputElement.value=a.innerHTML,this.usernameInputElement.value=this.usernameInputElement.value.replaceAll("<",""))}}};return c.extend({getInstance:function(){return e}}),c},NTESCommonNavigator.namespace("NTESCommonNavigator.utils"),NTESCommonNavigator.utils.Login=function(){var a=NTESCommonNavigator.base.Class(),b=NTESCommonNavigator.core.Event.Base;try{document.domain="163.com"}catch(c){}var d=NTESCommonNavigator.utils.Suggestion().getInstance(),e={listenFrame:!0,loginAction:"https://reg.163.com/logins.jsp",loginRedirect:"http://reg.163.com/redirect.jsp",successAction:"",failedAction:"",success:{},failed:{},errorMsg:{412:"\u60a8\u5c1d\u8bd5\u7684\u6b21\u6570\u5df2\u7ecf\u592a\u591a,\u8bf7\u8fc7\u4e00\u6bb5\u65f6\u95f4\u518d\u8bd5",414:"\u60a8\u7684IP\u767b\u5f55\u5931\u8d25\u6b21\u6570\u8fc7\u591a,\u8bf7\u7a0d\u540e\u518d\u8bd5",415:"\u60a8\u4eca\u5929\u767b\u5f55\u9519\u8bef\u6b21\u6570\u5df2\u7ecf\u592a\u591a,\u8bf7\u660e\u5929\u518d\u8bd5",416:"\u60a8\u7684IP\u4eca\u5929\u767b\u5f55\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",417:"\u60a8\u7684IP\u4eca\u5929\u767b\u5f55\u6b21\u6570\u8fc7\u591a\uff0c\u8bf7\u660e\u5929\u518d\u8bd5",418:"\u60a8\u4eca\u5929\u767b\u5f55\u6b21\u6570\u8fc7\u591a,\u8bf7\u660e\u5929\u518d\u8bd5",419:"\u60a8\u7684\u767b\u5f55\u64cd\u4f5c\u8fc7\u4e8e\u9891\u7e41\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5",420:"\u7528\u6237\u540d\u4e0d\u5b58\u5728",422:"\u5e10\u53f7\u88ab\u9501\u5b9a\uff0c\u8bf7\u60a8\u89e3\u9501\u540e\u518d\u767b\u5f55",424:"\u8be5\u9753\u53f7\u670d\u52a1\u5df2\u5230\u671f\uff0c\u8bf7\u60a8\u7eed\u8d39",425:"\u5916\u57df\u5e10\u53f7\u5e76\u4e14\u5728\u6fc0\u6d3b\u6709\u6548\u671f\u4ee5\u5185",426:"\u5916\u57df\u5e10\u53f7\u5e76\u4e14\u5df2\u7ecf\u8fc7\u4e86\u6fc0\u6d3b\u6709\u6548\u671f\u9650",427:"\u8d85\u65f6\uff0c\u5df2\u8d85\u8fc75\u5206\u949f\u6709\u6548\u671f",428:"\u9700\u8981\u8fdb\u5165\u4e2d\u95f4\u63d0\u9192\u9875\u9762",460:"\u5bc6\u7801\u4e0d\u6b63\u786e",500:"\u7cfb\u7edf\u7e41\u5fd9\uff0c\u8bf7\u60a8\u7a0d\u540e\u518d\u8bd5",503:"\u7cfb\u7edf\u7ef4\u62a4\uff0c\u8bf7\u60a8\u7a0d\u540e\u518d\u8bd5",1e3:"\u8bf7\u8f93\u5165\u6709\u6548\u7684\u7528\u6237\u540d"},commit:function(a){a&&(!this.frame&&this.createElements(),this.username.value=a.username,this.password.value=a.password,this.type.value=a.type,this.product.value=a.product,this.savelogin.value=a.savelogin,this.url.value=this.successAction,this.url2.value=this.failedAction,this.noRedirect.value=1,this.form.submit())},verifyLogin:function(){if(this.verifyCookie&&this.verifyCookie())for(var a in this.success)"function"==typeof this.success[a]&&this.success[a].call(this,arguments[0]);else for(var a in this.failed)"function"==typeof this.failed[a]&&(arguments[0]&&(arguments[0].errorMsg=this.errorMsg[this.errorMsg[arguments[0].errorType]?arguments[0].errorType:1e3]),this.failed[a].call(this,arguments[0]))},getSearches:function(a){a=a||window.location.search;for(var b=a.substring(1),c=b.split("&"),d={},e=0;e<c.length;e++){var f=c[e].split("=");f[0]&&(d[f[0]]=f[1]||null)}return d},createElements:function(){this.frame=this.createFrame(),this.form=this.createForm(),this.username=this.createInput("username"),this.password=this.createInput("password"),this.type=this.createInput("type"),this.product=this.createInput("product"),this.savelogin=this.createInput("savelogin"),this.url=this.createInput("url"),this.url2=this.createInput("url2"),this.noRedirect=this.createInput("noRedirect"),this.form.appendChild(this.username),this.form.appendChild(this.password),this.form.appendChild(this.type),this.form.appendChild(this.product),this.form.appendChild(this.savelogin),this.form.appendChild(this.url),this.form.appendChild(this.url2),this.form.appendChild(this.noRedirect),document.body.appendChild(this.form),document.body.appendChild(this.frame)},createInput:function(a){var b=this.toElement("<input/>");return b.setAttribute("name",a),b},toElement:function(){var a=document.createElement("div");return function(b){a.innerHTML=b;var c=a.firstChild;return a.removeChild(c),c}}(),createFrame:function(){var a,b=this,c="login_util_frame",d=0;return a=b.toElement('<iframe src="javascript:false;" name="'+c+'" />'),a.setAttribute("id",c),a.setAttribute("border","no"),a.style.display="none",a.onload=a.onreadystatechange=function(){b.listenFrame&&(this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||((d||this.contentWindow.location.search)&&b.verifyLogin(b.getSearches(this.contentWindow.location.search)),d++))},a},createForm:function(){var a,b=this;return a=b.toElement('<form method="post"></form>'),a.setAttribute("id","login_util_form"),a.setAttribute("action",this.loginAction),a.setAttribute("target",this.frame.name),a.style.display="none",a}};e.verifyCookie=function(){var a=NTES.cookie.get("S_INFO"),b=NTES.cookie.get("P_INFO");return a&&"2"!=b[2]},e.successAction="http://www.163.com/special/0077450P/login_frame.html",e.failedAction="http://www.163.com/special/0077450P/login_frame.html",e.success.userProduct=function(a){f.loginSuccess(a)},e.failed.userProduct=function(a){f.loginFailed(a)};var f={logined:!1,mailReg:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/i,trimReg:/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,formEl:NTES("#js_N_login_wrap"),fieldEl:NTES("#js_N_login_wrap input"),submitEl:NTES("#js_N_login_wrap .ntes-loginframe-btn"),tipEl:NTES("#js_N_login_wrap .ntes-loginframe-tips"),nameTmp:"",passTmp:"",passportLoaded:!1};return f.nameField=f.fieldEl[0],f.passField=f.fieldEl[1],f.saveField=f.fieldEl[2],f.tipText=f.tipEl[0].innerHTML,f.passField.type="password",d.bind(f.nameField),f.filter={"163.com":{read:1,name:"163",url:"http://entry.mail.163.com/coremail/fcg/ntesdoor2?verifycookie=1&lightweight=1"},"126.com":{read:1,name:"126",url:"http://entry.mail.126.com/cgi/ntesdoor?verifycookie=1&lightweight=1&style=-1"},"yeah.net":{read:1,name:"yeah",url:"http://entry.yeah.net/cgi/ntesdoor?verifycookie=1&lightweight=1&style=-1"},"188.com":{read:0,name:"188",url:"http://reg.mail.188.com/servlet/enter"},"vip.126.com":{read:0,name:"vip",url:"http://reg.vip.126.com/enterMail.m"},"vip.163.com":{read:0,name:"vip",url:"http://reg.vip.163.com/enterMail.m?enterVip=true-----------"}},f.trim=function(a){return a?(a+"").replace(f.trimReg,""):""},f.verifyFields=function(a,b){var c=f.nameField,d=f.passField;return 0==a.length?(f.addClass(c.parentNode,"tips-error"),this.loginFailed(),c.focus(),!1):0==b.length?(f.addClass(d.parentNode,"tips-error"),d.focus(),this.loginFailed(),!1):!0},f.submit=function(){var a,b=f.trim(f.nameField.value),c=f.passField.value,d=f.saveField.checked?1:0;f.nameTmp=b,f.passTmp=c,f.verifyFields(b,c)&&(a={username:b,password:c,savelogin:d,product:"163",type:1},e.commit(a))},f.loginSuccess=function(){f.logined=!0,a.trigger(b.LOGIN_SUCCESS)},f.loginFailed=function(c){if(f.logined=!1,a.trigger(b.LOGIN_FAIL),f.showError(c&&c.errorMsg?c.errorMsg:f.tipText),c)switch(parseInt(c.errorType)){case 420:setTimeout(function(){f.nameField.focus()},1e3);break;case 428:window.open(c.url?[unescape(c.url),"url="+location.href].join("&"):e.loginRedirect,"_self");break;case 460:setTimeout(function(){f.passField.focus()},1e3)}},f.showError=function(a){f.tipEl[0].innerHTML=a},f.hasClass=function(a,b){var c="*"+a.className.replace(/\s+/gi,"*")+"*";return-1!=c.indexOf("*"+b+"*")},f.addClass=function(a,b){if(!f.hasClass(a,b)){var c=a.className+" "+b;a.className=f.trim(c)}},f.removeClass=function(a,b){if(f.hasClass(a,b)){var c="*"+a.className.replace(/\s+/gi,"*")+"*";c=c.replace(new RegExp("\\*"+b+"\\*","ig")," ").replace(/\*/gi," "),a.className=f.trim(c)}},f.submitEl.addEvent("click",function(){f.submit()
}),f.formEl.addEvent("keydown",function(a){if(13==a.keyCode&&!e.verifyCookie()){if(d.hasShow)return void setTimeout(function(){f.passField.focus()},250);f.submit()}}),NTES.event.addEvent(f.fieldEl,"keyup",function(){var a=f.trim(f.nameField.value),b=f.passField.value;(f.nameTmp!=a||f.passTmp!=b)&&(f.removeClass(this.parentNode,"tips-error"),f.showError(f.tipText))}),a.extend({}),a},NTESCommonNavigator.namespace("NTESCommonNavigator.utils"),NTESCommonNavigator.utils.ChangeCookie=function(){var a=NTESCommonNavigator.base.Class(),b=document.createElement("div"),c="",d="163",e="",f="http://reg.163.com/chgcookie.jsp?",g="http://www.163.com/special/0077450P/login_frame.html",h='<iframe src="javascript:false;" name="changeCookie" frameborder="0" style="width:0;height:0;display:none;"></iframe>',i=function(a){try{document.body.removeChild(a)}catch(b){}},j=function(a){var j=null;b.innerHTML=h,e=NTES.cookie.get("USERTRACK"),c=String(NTES.cookie.get("P_INFO")).split("|")[0],document.body.appendChild(j=b.firstChild),j.onload=j.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||setTimeout(function(){NTES.cookie.get("S_INFO")&&a&&a(),i(j),j=null},400)},j.src=f+["username="+c,"product="+d,"userip="+e,"retUrl="+g,"loginUrl="+g].join("&")};return a.extend({invoke:function(a){NTES.ready(function(){j(a)})}}),a},NTESCommonNavigator.namespace("NTESCommonNavigator.data"),NTESCommonNavigator.data.UserInfo=function(){var a=NTESCommonNavigator.base.Class(),b=NTESCommonNavigator.utils.mix,c=NTESCommonNavigator.core.Event.Base,d=null,e=null,f=NTES,g="",h="",i=g,j=function(){k()},k=function(){d=Spine.Model.setup("UserInfo",["userName","userMail","userDomain","userIp","userLogin","userProduct"]),d.include({validate:function(){}}),e=d.create()},l=function(){var d=[],j=[],k="";g=String(f.cookie.get("P_INFO")),h=String(f.cookie.get("S_INFO")),d=g.split("|"),j=h.split("|"),k=d[0]||"",e=e.load({userName:b.encode(k.split("@")[0]),userMail:b.encode(k),userDomain:b.encode(k?k.split("@")[1]||"":""),userIp:b.encode(f.cookie.get("USERTRACK")||""),userLogin:!(!k||!h&&1!=d[2]),userProduct:b.encode(d[7]||"")}).save(),g==i&&g||(a.trigger(c.DATA_CHANGED,e),i=g)},m=function(){return e},n=function(){return g},o=function(){return h};return j(),a.extend({refresh:function(){return l(),a},getUserInfo:function(){return m()},getPInfo:function(){return n()},getSInfo:function(){return o()}}),a},NTESCommonNavigator.namespace("NTESCommonNavigator.data"),NTESCommonNavigator.data.MailInfo=function(){var a=NTESCommonNavigator.base.Class(),b=NTESCommonNavigator.core.Constant,c=b.Domain.DOMAIN,d=b.Domain.API,e=NTESCommonNavigator.core.Event.Base,f="http://msg.",g="/cgi/mc?funcid=getusrnewmsgcnt&fid=1&addSubFdrs=1&language=0&style=0&template=newmsgres_setcookie.htm&df=www163&callback=fAccountCountCall&username=",h="",i="",j=null,k=null,l=function(){m()},m=function(){j=Spine.Model.setup("MailInfo",["newCount","totalCount","userName"]),j.include({validate:function(){}}),k=j.create(),n({})},n=function(a){var b=parseInt(a.newCount)||0,c=parseInt(a.totalCount)||0;k=k.load({newCount:b,totalCount:c,userName:a.userName||""}).save()},o=function(b,j){b&&p(b),j&&q(j);for(var l=0;l<c.length;l++)if(h===c[l]){NTES.ajax.importJs(f+d[l]+g+i),window.fAccountCountCall=function(b,c,d){n({newCount:b,totalCount:c,userName:d}),a.trigger(e.DATA_LOADED,k)};break}},p=function(a){a&&(i=a)},q=function(a){a&&(h=a)},r=function(){return k};return l(),a.extend({refresh:function(a,b){o(a,b)},getMailInfo:function(){return r()},setUserMail:function(a){p(a)},setUserDomain:function(a){q(a)}}),a},NTESCommonNavigator.namespace("NTESCommonNavigator.data"),NTESCommonNavigator.data.LofterInfo=function(){var a=NTESCommonNavigator.base.Class(),b=(NTESCommonNavigator.core.Constant,NTESCommonNavigator.core.Event.Base),c=null,d=null,e="",f="",g=function(){h()},h=function(){c=Spine.Model.setup("LofterInfo",["count"]),c.include({validate:function(){}}),d=c.create(),i({})},i=function(a){a=parseInt(a)||0,d=d.load({count:a}).save()},j=function(c){c&&k(c),e="http://www.lofter.com/newNotice.do?email="+f+"&from=163top&callback=lofterInfoCallback",NTES.ajax.importJs(e,function(){"undefined"!=typeof window.lofterInfoCount&&(i(window.lofterInfoCount),a.trigger(b.DATA_LOADED,d))},"UTF-8")},k=function(a){if("string"==typeof a)return void(f=a);throw"invalid arguments for setUsermail"},l=function(){return f};return getLofterInfo=function(){return d},window.lofterInfoCallback=function(a){window.lofterInfoCount=a},g(),a.extend({refresh:function(a){j(a)},setUserMail:function(a){a&&k(a)},getUserMail:function(){return l()},getLofterInfo:function(){return getLofterInfo()}}),a},NTESCommonNavigator.namespace("NTESCommonNavigator.ui"),NTESCommonNavigator.ui.NavBar=function(){var a=NTESCommonNavigator.base.UI(),b=NTES,c=NTESCommonNavigator.utils.mix,d=".ntes-nav-msg-num",e=b("#js_N_navHighlight"),f=b("#js_N_navLoginBefore"),g=b("#js_N_NavLoginAfter"),h=b("#js_N_navUsername"),i=b("#js_N_navLogout"),j=b("#js_N_logined_warp"),k=b("#js_logined_suggest"),l=b("#js_login_suggest_wrap"),m=(b("#js_N_navHighlight"),b("#js_mail_url")),n=b("#js_N_navMailMsg"),o=b("#js_N_navLofterMsg"),p=b("#js_lofter_icon_url"),q=document.getElementById("js_lofter_pop_url").getElementsByTagName("a");return huatianMsg=b("#js_N_navHuatianMsg"),cookieNavHuatianShow="n_ht_s",huatianNavShow=!1,Constant=NTESCommonNavigator.core.Constant,products=Constant.PRODUCTS,defaultProducts=Constant.DEFAULT_PRODUCTS,loginOutUrl=Constant.LOG_IN_OUT_URL,selectMenu=null,userInfo=null,mailInfo=null,lofterInfo=null,init=function(){bindEvent(),selectMenu=new NTES.plugin.NTESSelectMenu},bindEvent=function(){var a=!1;window.addEvent("scroll",function(){document.documentElement.scrollTop+document.body.scrollTop>0?a||(e.addCss("ntes-nav-login-scroll"),j.addCss("ntes-nav-logined-scroll"),a=!0):a&&(e.removeCss("ntes-nav-login-scroll"),j.removeCss("ntes-nav-logined-scroll"),a=!1)}),b(n.parentNode).addEvent("click",function(){n.style.display="none"}),b(o.parentNode).addEvent("click",function(){o.style.display="none"}),b(huatianMsg.parentNode).addEvent("click",function(){huatianMsg.style.display="none",huatianNavShow&&NTES.cookie.set(cookieNavHuatianShow,0,"1d","163.com","/")})},login=function(a){if(userInfo=a,!userInfo)return void logout();var b=userInfo.userName,d=userInfo.userDomain,e=userInfo.userMail,j=/&df=163navi/i,k=products[d]?products[d].url:Constant.Path.DEFAULT_MAIL_PATH;k=k.replace(j,"&df=163nav_icon"),h.innerHTML=b.length<12?e:b.substr(0,12)+"...@"+d,i.href=loginOutUrl+"?username="+b+"&url="+c.encode(location.href),m.href=k,p.href+="&logined=true";for(var l=0,n=q.length;n>l;l++)q[l].href+="&logined=true";setLoginSuggest(userInfo.userProduct),f.style.display="none",g.style.display="block";var o=NTES.cookie.get(cookieNavHuatianShow);o?setHuatianInfo(parseInt(o)?!0:!1):Math.random()<=.5&&(NTES.cookie.set(cookieNavHuatianShow,1,"1d","163.com","/"),setHuatianInfo(!0))},setLoginSuggest=function(a){for(var b=a?a.split(~a.indexOf(",")?",":"&"):[],d=0,e=b.length>defaultProducts.length?defaultProducts.length:b.length,f="",g=["reg"],h=[];e>d;d++)f=b[d],!!products[f]&&g.push(f);for(1==g.length&&(g=g.concat(defaultProducts)),~Constant.Domain.DOMAIN.indexOf(userInfo.userDomain)&&g.splice(1,0,userInfo.userDomain);g.length;)f=g[0],h.push((1==g.length?"<li class='last'>":"<li>")+"<a href='"+products[f].url+"'><span>\u8fdb\u5165"+products[f].name+"</span></a></li>"),g.shift();k.innerHTML=h.join("").replace(/pInfo/g,c.encode(userInfo.userMail))},logout=function(){h.innerHTML="",k.innerHTML="",m.href=Constant.Path.DEFAULT_MAIL_PATH,i.href="javascript: void(0)",f.style.display="block",g.style.display="none",p.href=p.href.replace("&logined=true","");for(var a=0,b=q.length;b>a;a++)q[a].href=q[a].href.replace("&logined=true","");userInfo=null,setMailInfo(null),setLofterInfo(null),setHuatianInfo(null)},setMsg=function(a,c,e){var f=b(d,a).get(0);e||(c>99&&(c="99+"),0>c&&(c=0)),f&&a&&(c?(f.innerHTML=c,a.style.display="block"):(f.innerHTML="",a.style.display="none"))},setHuatianInfo=function(a){huatianNavShow=a,setMsg(huatianMsg,a?"N":"",!0)},setLofterInfo=function(a){setMsg(o,a?a.count:0),p.href=a&&a.count>0?p.href.replace("qb163sydl_20140917_01","qb163sydl_20140917_02"):p.href.replace("qb163sydl_20140917_02","qb163sydl_20140917_01"),lofterInfo=a},setMailInfo=function(a){setMsg(n,a?a.newCount:0),mailInfo=a},unFoldUserCenter=function(){l.style.display="block",setTimeout(function(){l.style.display=""},4e3)},init(),a.extend({login:function(a){login(a)},logout:function(){logout()},setLofterInfo:function(a){setLofterInfo(a)},setMailInfo:function(a){setMailInfo(a)},setHuatianInfo:function(a){setHuatianInfo(a)},unFoldUserCenter:function(){unFoldUserCenter()}}),a},NTESCommonNavigator.namespace("NTESCommonNavigator.ui"),NTESCommonNavigator.ui.Login=function(){var a=NTESCommonNavigator.base.UI(),b=NTES,c=b("#js_N_navHighlight"),d=b("#js_loginframe_username"),e=b.util,f=(e.extend,250),g=b("#js_passportUserNameList"),h=b("#js_N_navHighlight .ntes-nav-login-title"),i=b("#js_N_navHighlight .ntes-nav-loginframe-pop"),j=!1,k=b(document.body),l=null,m={shake:"ue-shake"},n="",o=function(){j=p(i),c.addCss("ntes-nav-login-normal"),h.addEvent("click",q),h.addEvent("mouseover",t),h.addEvent("mouseout",u),i.addEvent("mouseover",v),k.addEvent("click",w),g=g?g.get(0):null},p=function(a){return"none"!=b.style.getCurrentStyle(a,"display")?!0:!1},q=function(){return p(i)?z():A(),!1},r=function(){l&&(clearTimeout(l),l=null)},s=function(a){l=setTimeout(function(){a&&a()},f)},t=function(){r(),A()},u=function(){r(),s(function(){z()})},v=function(){r()},w=function(a){if(j){for(var b=a.target||a.srcElement,c=i.get(0),d=h.get(0);b;){if(b==c||b==d||b==g)return;b=b.parentNode}return z(),!1}},x=function(){z()},y=function(){B("shake")},z=function(){i.get(0).style.display="none",j=!1,c.addCss("ntes-nav-login-normal"),c.removeCss("ntes-nav-login-active"),i.removeCss("ue-animation"),n&&i.removeCss(n)},A=function(){i.get(0).style.display="block",j=!0,c.addCss("ntes-nav-login-active"),c.removeCss("ntes-nav-login-normal"),i.addCss("ue-animation")},B=function(a){var b=m[a]||"";n&&i.removeCss(n),b&&i.addCss(b),n=b,n&&setTimeout(function(){i.removeCss(n)},1e3)},C=function(a){d.value=a||""};return o(),a.extend({show:function(){A()},hide:function(){z()},success:function(){x()},fail:function(){y()},setUserName:function(a){C(a)}}),a},NTESCommonNavigator.namespace("NTESCommonNavigator.core"),NTESCommonNavigator.core.Model=function(){var a=NTESCommonNavigator.base.Class(),b=NTESCommonNavigator.core.Event.Base,c=NTESCommonNavigator.core.Event.Model,d=NTESCommonNavigator.data.UserInfo(),e=NTESCommonNavigator.data.MailInfo(),f=NTESCommonNavigator.data.LofterInfo(),g=NTESCommonNavigator.utils.ChangeCookie(),h=function(){e.bind(b.DATA_LOADED,k),f.bind(b.DATA_LOADED,l),d.bind(b.DATA_CHANGED,j)},i=function(){var a=d.getUserInfo();e.refresh(a.userName,a.userDomain),f.refresh(a.userMail)},j=function(c){c.userLogin&&(d.getSInfo()?i():g.invoke(function(){i()})),a.trigger(b.DATA_CHANGED,c)},k=function(b){a.trigger(c.MAIL_INFO_LOADED,b)},l=function(b){a.trigger(c.LOFTER_INFO_LOADED,b)};return h(),a.extend({refresh:function(){d.refresh()}}),a},NTESCommonNavigator.namespace("NTESCommonNavigator.core"),NTESCommonNavigator.core.View=function(a){var b=NTESCommonNavigator.base.Class(),c=NTESCommonNavigator.ui.NavBar(),d=NTESCommonNavigator.ui.Login(),e=NTESCommonNavigator.core.Event.Model,f=NTESCommonNavigator.core.Event.Base,g=function(){a.bind(e.MAIL_INFO_LOADED,h),a.bind(e.LOFTER_INFO_LOADED,i),a.bind(f.DATA_CHANGED,j)},h=function(a){c.setMailInfo(a)},i=function(a){c.setLofterInfo(a)},j=function(a){a.userLogin?c.login(a):(c.logout(),a.userMail&&d.setUserName(a.userMail))},k=function(){d.success(),c.unFoldUserCenter()},l=function(){d.fail()};return g(),b.extend({loginSuccess:function(){k()},loginFail:function(){l()}}),b},NTESCommonNavigator.namespace("NTESCommonNavigator.core"),NTESCommonNavigator.core.Controller=function(){var a=NTESCommonNavigator.base.Class(),b=NTESCommonNavigator.core.Model(),c=NTESCommonNavigator.core.View(b),d=NTESCommonNavigator.utils.Login(),e=NTESCommonNavigator.core.Event.Base,f=NTESCommonNavigator.core.Event.Model,g=function(){d.bind(e.LOGIN_SUCCESS,k),d.bind(e.LOGIN_FAIL,l),b.bind(e.DATA_CHANGED,j),b.bind(f.MAIL_INFO_LOADED,h),b.bind(f.LOFTER_INFO_LOADED,i)},h=function(b){a.trigger(f.MAIL_INFO_LOADED,b)},i=function(b){a.trigger(f.LOFTER_INFO_LOADED,b)},j=function(b){a.trigger(e.DATA_CHANGED,b)},k=function(){b.refresh(),c.loginSuccess()},l=function(){b.refresh(),c.loginFail()};return g(),a.extend({refresh:function(){b.refresh()},getUserInfo:function(){return b.getUserInfo()}}),a};